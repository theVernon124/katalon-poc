/* eslint-disable no-console */

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _libInstaller = require('../../lib/installer');

var _teen_process = require('teen_process');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('downloading WAD', function () {
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.prev = 0;
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap((0, _teen_process.exec)('msiexec', ['/X{' + _libInstaller.WAD_GUID + '}', '/q']));

        case 3:
          context$2$0.next = 10;
          break;

        case 5:
          context$2$0.prev = 5;
          context$2$0.t0 = context$2$0['catch'](0);

          // if we get a 1605 error, that's ok, that means nothing was installed
          // if we get some other kind of error, we should fail this test
          if (context$2$0.t0.code === 1603) {
            console.log("You need to be an admin to run this test");
          }

          if (!(context$2$0.t0.code !== 1605)) {
            context$2$0.next = 10;
            break;
          }

          throw context$2$0.t0;

        case 10:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this, [[0, 5]]);
  });

  it('should download and validate WinAppDriver', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _libInstaller.setupWAD)());

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
});

// uninstall WAD first
// contains its own verification of md5 so not much to do
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL2luc3RhbGxlci1lMmUtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7NEJBRW1DLHFCQUFxQjs7NEJBQ25DLGNBQWM7O29CQUNsQixNQUFNOzs7OzhCQUNJLGtCQUFrQjs7OztBQUU3QyxrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUNkLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0FBRXpCLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxZQUFZO0FBQ3RDLFFBQU0sQ0FBQzs7Ozs7OzJDQUdHLHdCQUFLLFNBQVMsRUFBRSx1Q0FBb0IsSUFBSSxDQUFDLENBQUM7Ozs7Ozs7Ozs7OztBQUloRCxjQUFJLGVBQUksSUFBSSxLQUFLLElBQUksRUFBRTtBQUNyQixtQkFBTyxDQUFDLEdBQUcsQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO1dBQ3pEOztnQkFDRyxlQUFJLElBQUksS0FBSyxJQUFJLENBQUE7Ozs7Ozs7Ozs7OztHQUl4QixDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLDJDQUEyQyxFQUFFOzs7OzsyQ0FDeEMsNkJBQVU7Ozs7Ozs7R0FDakIsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvZTJlL2luc3RhbGxlci1lMmUtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG5cbmltcG9ydCB7IHNldHVwV0FELCBXQURfR1VJRCB9IGZyb20gJy4uLy4uL2xpYi9pbnN0YWxsZXInO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ2Rvd25sb2FkaW5nIFdBRCcsIGZ1bmN0aW9uICgpIHtcbiAgYmVmb3JlKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAvLyB1bmluc3RhbGwgV0FEIGZpcnN0XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGV4ZWMoJ21zaWV4ZWMnLCBbYC9YeyR7V0FEX0dVSUR9fWAsICcvcSddKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIGlmIHdlIGdldCBhIDE2MDUgZXJyb3IsIHRoYXQncyBvaywgdGhhdCBtZWFucyBub3RoaW5nIHdhcyBpbnN0YWxsZWRcbiAgICAgIC8vIGlmIHdlIGdldCBzb21lIG90aGVyIGtpbmQgb2YgZXJyb3IsIHdlIHNob3VsZCBmYWlsIHRoaXMgdGVzdFxuICAgICAgaWYgKGVyci5jb2RlID09PSAxNjAzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiWW91IG5lZWQgdG8gYmUgYW4gYWRtaW4gdG8gcnVuIHRoaXMgdGVzdFwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChlcnIuY29kZSAhPT0gMTYwNSkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBpdCgnc2hvdWxkIGRvd25sb2FkIGFuZCB2YWxpZGF0ZSBXaW5BcHBEcml2ZXInLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgYXdhaXQgc2V0dXBXQUQoKTsgLy8gY29udGFpbnMgaXRzIG93biB2ZXJpZmljYXRpb24gb2YgbWQ1IHNvIG5vdCBtdWNoIHRvIGRvXG4gIH0pO1xufSk7Il0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
