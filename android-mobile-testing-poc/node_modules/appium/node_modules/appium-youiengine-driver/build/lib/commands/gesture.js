'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var _utils = require('../utils');

var commands = {};

commands.click = function callee$0$0(el) {
  var retVal;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.tapEl(el));

      case 2:
        retVal = context$1$0.sent;
        return context$1$0.abrupt('return', retVal);

      case 4:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.tapEl = function callee$0$0(el, longPress) {
  var commandName, commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:

        // perform a tap on the given element
        // if longPress is true, the tap becomes a longPress action

        el = (0, _utils.unwrapEl)(el);

        commandName = 'tap';

        if (longPress) {
          commandName = 'longpress';
        }

        commandObject = {
          name: commandName,
          args: ['' + el]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 7:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 9;

        result = JSON.parse(data);
        context$1$0.next = 16;
        break;

      case 13:
        context$1$0.prev = 13;
        context$1$0.t0 = context$1$0['catch'](9);
        throw new Error("Bad response from click");

      case 16:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 18;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);

      case 18:
        return context$1$0.abrupt('return', result.value);

      case 19:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[9, 13]]);
};

commands.tapElXY = function callee$0$0(el, x, y, longPress) {
  var commandName, commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:

        // perform a tap on the given element at the given x,y offset
        // if longPress is true, the tap becomes a longPress action

        el = (0, _utils.unwrapEl)(el);

        commandName = 'tap';

        if (longPress) {
          commandName = 'longpress';
        }

        commandObject = {
          name: commandName,
          args: ['' + el, '' + x, '' + y]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 7:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 9;

        result = JSON.parse(data);
        context$1$0.next = 16;
        break;

      case 13:
        context$1$0.prev = 13;
        context$1$0.t0 = context$1$0['catch'](9);
        throw new Error("Bad response from tapElXY");

      case 16:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND)) {
          context$1$0.next = 20;
          break;
        }

        throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);

      case 20:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT)) {
          context$1$0.next = 24;
          break;
        }

        throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);

      case 24:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 26;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);

      case 26:
        return context$1$0.abrupt('return', result.value);

      case 27:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[9, 13]]);
};

commands.tapXY = function callee$0$0(x, y, longPress) {
  var commandName, commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        commandName = 'tap';

        if (longPress === true) {
          commandName = 'longpress';
        }

        commandObject = {
          name: commandName,
          args: ['' + x, '' + y]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 6;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 6:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 8;

        result = JSON.parse(data);
        context$1$0.next = 15;
        break;

      case 12:
        context$1$0.prev = 12;
        context$1$0.t0 = context$1$0['catch'](8);
        throw new Error("Bad response from tapXY");

      case 15:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 17;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);

      case 17:
        return context$1$0.abrupt('return', result.value);

      case 18:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[8, 12]]);
};

commands.tap = function callee$0$0(gestures, longPress) {
  var elementId, x, y;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        elementId = gestures[0].options.element;
        x = gestures[0].options.x;
        y = gestures[0].options.y;

        if (!elementId) {
          context$1$0.next = 13;
          break;
        }

        if (!(x && y)) {
          context$1$0.next = 9;
          break;
        }

        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.tapElXY(elementId, x, y, longPress));

      case 7:
        context$1$0.next = 11;
        break;

      case 9:
        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(this.tapEl(elementId, longPress));

      case 11:
        context$1$0.next = 15;
        break;

      case 13:
        context$1$0.next = 15;
        return _regeneratorRuntime.awrap(this.tapXY(x, y, longPress));

      case 15:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.doSwipe = function callee$0$0(gestures, longPress) {
  var press, moveTo, startX, startY, deltaX, deltaY, _ref, x, y, _ref2, width, height, _ref3, _ref4, commandName, commandObject, commandJSON, data, result;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        press = gestures[0];
        moveTo = gestures[1];
        startX = press.options.x || 0, startY = press.options.y || 0, deltaX = moveTo.options.x || 0, deltaY = moveTo.options.y || 0;

        if (!press.options.element) {
          context$1$0.next = 17;
          break;
        }

        context$1$0.next = 6;
        return _regeneratorRuntime.awrap(this.getLocation(press.options.element));

      case 6:
        _ref = context$1$0.sent;
        x = _ref.x;
        y = _ref.y;
        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(this.getSize(press.options.element));

      case 11:
        _ref2 = context$1$0.sent;
        width = _ref2.width;
        height = _ref2.height;

        // Use the middle of the element to press on, unless an offset from
        // top left of the element has been specified
        if (!press.options.x && !press.options.y && width && height) {
          startX += width / 2;
          startY += height / 2;
        }

        startX += x || 0;
        startY += y || 0;

      case 17:
        if (!moveTo.options.element) {
          context$1$0.next = 31;
          break;
        }

        context$1$0.next = 20;
        return _regeneratorRuntime.awrap(this.getLocation(moveTo.options.element));

      case 20:
        _ref3 = context$1$0.sent;
        x = _ref3.x;
        y = _ref3.y;
        context$1$0.next = 25;
        return _regeneratorRuntime.awrap(this.getSize(moveTo.options.element));

      case 25:
        _ref4 = context$1$0.sent;
        width = _ref4.width;
        height = _ref4.height;

        deltaX += x || 0;
        deltaY += y || 0;

        // Use the middle of the element to move to, unless an offset from
        // top left of the element has been specified
        if (!moveTo.options.x && !moveTo.options.y && width && height) {
          deltaX += width / 2;
          deltaY += height / 2;
        }

      case 31:
        commandName = 'swipe';

        if (longPress === true) {
          commandName = 'longpressswipe';
        }

        commandObject = {
          name: commandName,
          args: ['' + startX, '' + startY, '' + deltaX, '' + deltaY]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 37;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 37:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 39;

        result = JSON.parse(data);
        context$1$0.next = 46;
        break;

      case 43:
        context$1$0.prev = 43;
        context$1$0.t0 = context$1$0['catch'](39);
        throw new Error("Bad response from doSwipe");

      case 46:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 48;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);

      case 48:
        return context$1$0.abrupt('return', result.value);

      case 49:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[39, 43]]);
};

commands.performTouch = function callee$0$0(gestures) {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!(gestures.length === 3)) {
          context$1$0.next = 13;
          break;
        }

        if (!(gestures[0].action === 'press' && gestures[1].action === 'moveTo' && gestures[2].action === 'release')) {
          context$1$0.next = 7;
          break;
        }

        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.doSwipe(gestures, false));

      case 4:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 7:
        if (!(gestures[0].action === 'longPress' && gestures[1].action === 'moveTo' && gestures[2].action === 'release')) {
          context$1$0.next = 11;
          break;
        }

        context$1$0.next = 10;
        return _regeneratorRuntime.awrap(this.doSwipe(gestures, true));

      case 10:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 11:
        context$1$0.next = 31;
        break;

      case 13:
        if (!(gestures.length === 2)) {
          context$1$0.next = 26;
          break;
        }

        if (!(gestures[0].action === 'press' && gestures[1].action === 'release')) {
          context$1$0.next = 20;
          break;
        }

        context$1$0.next = 17;
        return _regeneratorRuntime.awrap(this.tap(gestures, false));

      case 17:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 20:
        if (!(gestures[0].action === 'longPress' && gestures[1].action === 'release')) {
          context$1$0.next = 24;
          break;
        }

        context$1$0.next = 23;
        return _regeneratorRuntime.awrap(this.tap(gestures, true));

      case 23:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 24:
        context$1$0.next = 31;
        break;

      case 26:
        if (!(gestures.length === 1)) {
          context$1$0.next = 31;
          break;
        }

        if (!(gestures[0].action === 'tap')) {
          context$1$0.next = 31;
          break;
        }

        context$1$0.next = 30;
        return _regeneratorRuntime.awrap(this.tap(gestures, false));

      case 30:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 31:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

exports['default'] = commands;
module.exports = exports['default'];

// get status returned

// perform a tap at the given x,y screen coordinate
// if longPress is true, the tap becomes a longPress action

// get status returned

// parse the given gestures array to call the appropriate tap method
// if longPress is true, the tap is a long press action

// we are either tapping on the default location of the element
// top left has been specified of the element has been specified

// tapping with an element parameter is the same as click on a WebElement

// we are tapping at an absolute x,y coordinate on the screen

// parse input values

// construct the command object

// get status returned
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O2dDQUF1QixvQkFBb0I7O3FCQUNZLFVBQVU7O0FBRWpFLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQzs7QUFFbEIsUUFBUSxDQUFDLEtBQUssR0FBRyxvQkFBZ0IsRUFBRTtNQUM3QixNQUFNOzs7Ozt5Q0FBUyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQzs7O0FBQTdCLGNBQU07NENBQ0gsTUFBTTs7Ozs7OztDQUNkLENBQUM7O0FBRUYsUUFBUSxDQUFDLEtBQUssR0FBRyxvQkFBZ0IsRUFBRSxFQUFFLFNBQVM7TUFPeEMsV0FBVyxFQUtYLGFBQWEsRUFJYixXQUFXLEVBRVgsSUFBSSxFQUVKLE1BQU07Ozs7Ozs7O0FBZlYsVUFBRSxHQUFHLHFCQUFTLEVBQUUsQ0FBQyxDQUFDOztBQUVkLG1CQUFXLEdBQUcsS0FBSzs7QUFDdkIsWUFBSSxTQUFTLEVBQUU7QUFDYixxQkFBVyxHQUFHLFdBQVcsQ0FBQztTQUMzQjs7QUFFRyxxQkFBYSxHQUFHO0FBQ2xCLGNBQUksRUFBRSxXQUFXO0FBQ2pCLGNBQUksRUFBRSxNQUFJLEVBQUUsQ0FBRztTQUNoQjtBQUNHLG1CQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUM7O3lDQUU5QixJQUFJLENBQUMsb0JBQW9CLENBQUMsV0FBVyxDQUFDOzs7QUFBbkQsWUFBSTtBQUVKLGNBQU07OztBQUVSLGNBQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDOzs7Ozs7O2NBRXBCLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDOzs7Y0FJeEMsTUFBTSxDQUFDLE1BQU0sS0FBSyxvQ0FBNkIsdUJBQXVCLENBQUE7Ozs7O2NBQ2xFLElBQUkseUJBQU8sMEJBQTBCLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQzs7OzRDQUVwRCxNQUFNLENBQUMsS0FBSzs7Ozs7OztDQUNwQixD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QUFDLE1BQU0sS0FBSyxDQUFDLENBQUE7Ozs7O2NBRTFCLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssT0FBTyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssU0FBUyxDQUFBOzs7Ozs7eUNBRXZELElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQzs7Ozs7O2NBRTdCLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQU0sV0FBVyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQU0sU0FBUyxDQUFBOzs7Ozs7eUNBRXBFLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQzs7Ozs7Ozs7OztjQUc5QixRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQTs7Ozs7Y0FFNUIsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxLQUFLLENBQUE7Ozs7Ozt5Q0FFZixJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUM7Ozs7Ozs7Ozs7Q0FHM0MsQ0FBQzs7cUJBRWEsUUFBUSIsImZpbGUiOiJsaWIvY29tbWFuZHMvZ2VzdHVyZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgeyB1bndyYXBFbCwgeW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcyB9IGZyb20gJy4uL3V0aWxzJztcblxubGV0IGNvbW1hbmRzID0ge307XG5cbmNvbW1hbmRzLmNsaWNrID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGxldCByZXRWYWwgPSBhd2FpdCB0aGlzLnRhcEVsKGVsKTtcbiAgcmV0dXJuIHJldFZhbDtcbn07XG5cbmNvbW1hbmRzLnRhcEVsID0gYXN5bmMgZnVuY3Rpb24gKGVsLCBsb25nUHJlc3MpIHtcblxuICAvLyBwZXJmb3JtIGEgdGFwIG9uIHRoZSBnaXZlbiBlbGVtZW50XG4gIC8vIGlmIGxvbmdQcmVzcyBpcyB0cnVlLCB0aGUgdGFwIGJlY29tZXMgYSBsb25nUHJlc3MgYWN0aW9uXG5cbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgbGV0IGNvbW1hbmROYW1lID0gJ3RhcCc7XG4gIGlmIChsb25nUHJlc3MpIHtcbiAgICBjb21tYW5kTmFtZSA9ICdsb25ncHJlc3MnO1xuICB9XG5cbiAgdmFyIGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogY29tbWFuZE5hbWUsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIHZhciBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gY2xpY2tcIik7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9TVEFMRV9FTEVNRU5UKVxuICAgIHRocm93IG5ldyBlcnJvcnMuU3RhbGVFbGVtZW50UmVmZXJlbmNlRXJyb3IocmVzdWx0LnZhbHVlKTtcblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMudGFwRWxYWSA9IGFzeW5jIGZ1bmN0aW9uIChlbCwgeCwgeSwgbG9uZ1ByZXNzKSB7XG5cbiAgLy8gcGVyZm9ybSBhIHRhcCBvbiB0aGUgZ2l2ZW4gZWxlbWVudCBhdCB0aGUgZ2l2ZW4geCx5IG9mZnNldFxuICAvLyBpZiBsb25nUHJlc3MgaXMgdHJ1ZSwgdGhlIHRhcCBiZWNvbWVzIGEgbG9uZ1ByZXNzIGFjdGlvblxuXG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGxldCBjb21tYW5kTmFtZSA9ICd0YXAnO1xuICBpZiAobG9uZ1ByZXNzKSB7XG4gICAgY29tbWFuZE5hbWUgPSAnbG9uZ3ByZXNzJztcbiAgfVxuXG4gIHZhciBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6IGNvbW1hbmROYW1lLFxuICAgIGFyZ3M6IFtgJHtlbH1gLCBgJHt4fWAsIGAke3l9YF1cbiAgfTtcblxuICB2YXIgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSB0YXBFbFhZXCIpO1xuICB9XG5cbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1VOS05PV05fQ09NTUFORCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkNvbW1hbmRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuU3RhbGVFbGVtZW50UmVmZXJlbmNlRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5jb21tYW5kcy50YXBYWSA9IGFzeW5jIGZ1bmN0aW9uKHgsIHksIGxvbmdQcmVzcykge1xuXG4gIC8vIHBlcmZvcm0gYSB0YXAgYXQgdGhlIGdpdmVuIHgseSBzY3JlZW4gY29vcmRpbmF0ZVxuICAvLyBpZiBsb25nUHJlc3MgaXMgdHJ1ZSwgdGhlIHRhcCBiZWNvbWVzIGEgbG9uZ1ByZXNzIGFjdGlvblxuXG4gIGxldCBjb21tYW5kTmFtZSA9ICd0YXAnO1xuICBpZiAobG9uZ1ByZXNzID09PSB0cnVlKSB7XG4gICAgY29tbWFuZE5hbWUgPSAnbG9uZ3ByZXNzJztcbiAgfVxuXG4gIHZhciBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6IGNvbW1hbmROYW1lLFxuICAgIGFyZ3M6IFtgJHt4fWAsIGAke3l9YF1cbiAgfTtcblxuICB2YXIgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSB0YXBYWVwiKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWRcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1NUQUxFX0VMRU1FTlQpXG4gICAgdGhyb3cgbmV3IGVycm9ycy5TdGFsZUVsZW1lbnRSZWZlcmVuY2VFcnJvcihyZXN1bHQudmFsdWUpO1xuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5jb21tYW5kcy50YXAgPSBhc3luYyBmdW5jdGlvbiAoZ2VzdHVyZXMsIGxvbmdQcmVzcykge1xuXG4gIC8vIHBhcnNlIHRoZSBnaXZlbiBnZXN0dXJlcyBhcnJheSB0byBjYWxsIHRoZSBhcHByb3ByaWF0ZSB0YXAgbWV0aG9kXG4gIC8vIGlmIGxvbmdQcmVzcyBpcyB0cnVlLCB0aGUgdGFwIGlzIGEgbG9uZyBwcmVzcyBhY3Rpb25cblxuICBsZXQgZWxlbWVudElkID0gZ2VzdHVyZXNbMF0ub3B0aW9ucy5lbGVtZW50O1xuICBsZXQgeCA9IGdlc3R1cmVzWzBdLm9wdGlvbnMueDtcbiAgbGV0IHkgPSBnZXN0dXJlc1swXS5vcHRpb25zLnk7XG5cbiAgaWYgKGVsZW1lbnRJZCkge1xuXG4gICAgLy8gd2UgYXJlIGVpdGhlciB0YXBwaW5nIG9uIHRoZSBkZWZhdWx0IGxvY2F0aW9uIG9mIHRoZSBlbGVtZW50XG4gICAgLy8gdG9wIGxlZnQgaGFzIGJlZW4gc3BlY2lmaWVkIG9mIHRoZSBlbGVtZW50IGhhcyBiZWVuIHNwZWNpZmllZFxuXG4gICAgaWYgKHggJiYgeSkge1xuICAgICAgYXdhaXQgdGhpcy50YXBFbFhZKGVsZW1lbnRJZCwgeCwgeSwgbG9uZ1ByZXNzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gdGFwcGluZyB3aXRoIGFuIGVsZW1lbnQgcGFyYW1ldGVyIGlzIHRoZSBzYW1lIGFzIGNsaWNrIG9uIGEgV2ViRWxlbWVudFxuICAgICAgYXdhaXQgdGhpcy50YXBFbChlbGVtZW50SWQsIGxvbmdQcmVzcyk7XG4gICAgfVxuICB9IGVsc2Uge1xuXG4gICAgLy8gd2UgYXJlIHRhcHBpbmcgYXQgYW4gYWJzb2x1dGUgeCx5IGNvb3JkaW5hdGUgb24gdGhlIHNjcmVlblxuICAgIGF3YWl0IHRoaXMudGFwWFkoeCwgeSwgbG9uZ1ByZXNzKTtcbiAgfVxufTtcblxuY29tbWFuZHMuZG9Td2lwZSA9IGFzeW5jIGZ1bmN0aW9uIChnZXN0dXJlcywgbG9uZ1ByZXNzKSB7XG5cbiAgLy8gcGFyc2UgaW5wdXQgdmFsdWVzXG4gIGxldCBwcmVzcyA9IGdlc3R1cmVzWzBdO1xuICBsZXQgbW92ZVRvID0gZ2VzdHVyZXNbMV07XG4gIGxldCBzdGFydFggPSBwcmVzcy5vcHRpb25zLnggfHwgMCxcbiAgICAgIHN0YXJ0WSA9IHByZXNzLm9wdGlvbnMueSB8fCAwLFxuICAgICAgZGVsdGFYID0gbW92ZVRvLm9wdGlvbnMueCB8fCAwLFxuICAgICAgZGVsdGFZID0gbW92ZVRvLm9wdGlvbnMueSB8fCAwO1xuXG4gIGlmIChwcmVzcy5vcHRpb25zLmVsZW1lbnQpIHtcbiAgICBsZXQge3gsIHl9ID0gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbihwcmVzcy5vcHRpb25zLmVsZW1lbnQpO1xuICAgIGxldCB7d2lkdGgsIGhlaWdodH0gPSBhd2FpdCB0aGlzLmdldFNpemUocHJlc3Mub3B0aW9ucy5lbGVtZW50KTtcblxuICAgIC8vIFVzZSB0aGUgbWlkZGxlIG9mIHRoZSBlbGVtZW50IHRvIHByZXNzIG9uLCB1bmxlc3MgYW4gb2Zmc2V0IGZyb21cbiAgICAvLyB0b3AgbGVmdCBvZiB0aGUgZWxlbWVudCBoYXMgYmVlbiBzcGVjaWZpZWRcbiAgICBpZiAoIXByZXNzLm9wdGlvbnMueCAmJiAhcHJlc3Mub3B0aW9ucy55ICYmIHdpZHRoICYmIGhlaWdodCkge1xuICAgICAgc3RhcnRYICs9IHdpZHRoIC8gMjtcbiAgICAgIHN0YXJ0WSArPSBoZWlnaHQgLyAyO1xuICAgIH1cblxuICAgIHN0YXJ0WCArPSB4IHx8IDA7XG4gICAgc3RhcnRZICs9IHkgfHwgMDtcblxuICB9XG4gIFxuICBpZiAobW92ZVRvLm9wdGlvbnMuZWxlbWVudCkge1xuICAgIGxldCB7eCwgeX0gPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uKG1vdmVUby5vcHRpb25zLmVsZW1lbnQpO1xuICAgIGxldCB7d2lkdGgsIGhlaWdodH0gPSBhd2FpdCB0aGlzLmdldFNpemUobW92ZVRvLm9wdGlvbnMuZWxlbWVudCk7XG4gICAgZGVsdGFYICs9IHggfHwgMDtcbiAgICBkZWx0YVkgKz0geSB8fCAwO1xuXG4gICAgLy8gVXNlIHRoZSBtaWRkbGUgb2YgdGhlIGVsZW1lbnQgdG8gbW92ZSB0bywgdW5sZXNzIGFuIG9mZnNldCBmcm9tXG4gICAgLy8gdG9wIGxlZnQgb2YgdGhlIGVsZW1lbnQgaGFzIGJlZW4gc3BlY2lmaWVkXG4gICAgaWYgKCFtb3ZlVG8ub3B0aW9ucy54ICYmICFtb3ZlVG8ub3B0aW9ucy55ICYmIHdpZHRoICYmIGhlaWdodCkge1xuICAgICAgZGVsdGFYICs9IHdpZHRoIC8gMjtcbiAgICAgIGRlbHRhWSArPSBoZWlnaHQgLyAyO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNvbnN0cnVjdCB0aGUgY29tbWFuZCBvYmplY3RcbiAgbGV0IGNvbW1hbmROYW1lID0gJ3N3aXBlJztcbiAgaWYgKGxvbmdQcmVzcyA9PT0gdHJ1ZSkge1xuICAgIGNvbW1hbmROYW1lID0gJ2xvbmdwcmVzc3N3aXBlJztcbiAgfVxuXG4gIHZhciBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6IGNvbW1hbmROYW1lLFxuICAgIGFyZ3M6IFtgJHtzdGFydFh9YCwgYCR7c3RhcnRZfWAsIGAke2RlbHRhWH1gLCBgJHtkZWx0YVl9YF1cbiAgfTtcblxuICB2YXIgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBkb1N3aXBlXCIpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZFxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVClcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yKHJlc3VsdC52YWx1ZSk7XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcblxufTtcblxuY29tbWFuZHMucGVyZm9ybVRvdWNoID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmVzKSB7XG5cbiAgaWYgKGdlc3R1cmVzLmxlbmd0aCA9PT0gMykge1xuXG4gICAgaWYgKGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ3ByZXNzJyAmJiBnZXN0dXJlc1sxXS5hY3Rpb24gPT09ICdtb3ZlVG8nICYmIGdlc3R1cmVzWzJdLmFjdGlvbiA9PT0gJ3JlbGVhc2UnKSB7XG5cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmRvU3dpcGUoZ2VzdHVyZXMsIGZhbHNlKTtcblxuICAgIH0gZWxzZSBpZiAoZ2VzdHVyZXNbMF0uYWN0aW9uID09PSAnbG9uZ1ByZXNzJyAmJiBnZXN0dXJlc1sxXS5hY3Rpb24gPT09ICdtb3ZlVG8nICYmIGdlc3R1cmVzWzJdLmFjdGlvbiA9PT0gJ3JlbGVhc2UnKSB7XG5cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmRvU3dpcGUoZ2VzdHVyZXMsIHRydWUpO1xuICAgIH1cblxuICB9IGVsc2UgaWYgKGdlc3R1cmVzLmxlbmd0aCA9PT0gMikge1xuXG4gICAgaWYgKGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ3ByZXNzJyAmJiBnZXN0dXJlc1sxXS5hY3Rpb24gPT09ICdyZWxlYXNlJykge1xuXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy50YXAoZ2VzdHVyZXMsIGZhbHNlKTtcblxuICAgIH0gZWxzZSBpZiAoZ2VzdHVyZXNbMF0uYWN0aW9uICA9PT0gJ2xvbmdQcmVzcycgJiYgZ2VzdHVyZXNbMV0uYWN0aW9uICA9PT0gJ3JlbGVhc2UnKSB7XG5cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnRhcChnZXN0dXJlcywgdHJ1ZSk7XG5cbiAgICB9XG4gIH0gZWxzZSBpZiAoZ2VzdHVyZXMubGVuZ3RoID09PSAxKSB7XG5cbiAgaWYgKGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ3RhcCcpIHtcblxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMudGFwKGdlc3R1cmVzLCBmYWxzZSk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
